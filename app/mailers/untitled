class TicketMailer < ActionMailer::Base
  default :from => "Billetterie@musicales-tannay.ch"

  def ticket(order)
  	@order = order
  	@qr = RQRCode::QRCode.new("musicales-tannay.ch/orders/#{@order.code}/validate")

	png = @qr.to_img
	png.resize(200,200).save("#{@order.code}.png")

	ticket_image
	column_image
	row_image

	result = ticket_image.composite(png) do |c|
  		c.compose "Over"    # OverCompositeOp
 	 	c.geometry "+500+100" # copy second_image onto first_image from (500, 100)
	end

	result = result.composite(column_image) do |c|
  		c.compose "Over"    # OverCompositeOp
 	 	c.geometry "+500+100" # copy second_image onto first_image from (500, 100)
	end

	result = result.composite(row_image) do |c|
  		c.compose "Over"    # OverCompositeOp
 	 	c.geometry "+500+100" # copy second_image onto first_image from (500, 100)
	end

  	attachments.inline["#{@order.code}.png"] =File.read("#{@order.code}.png")

    mail(:to => @order.email, :from => "Billetterie@musicales-tannay.ch", :subject => "Vos billets pour les variations musicales de Tannay")
  end


end




<!--<%= #button_to "Annuler (TBD)", :action =>"cancel", :controller => "reservations" , :class => "btn span2"%>-->